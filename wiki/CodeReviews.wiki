#summary Results of code reviews we've done so far.
<wiki:toc max_depth="1" />

= Personal Code Reviews =
Personal code reviews were done on team members own time.  The process was to review code that was not written by them, and log issues they saw here.

== Martina ==

  * Box.java:
    * Line 36: Why are values hard coded for rotation?

  * !GameObject.java: 
    * Lines 70-78: Commented out code.  Is this still needed?  If not, delete it.

  * Grid.java: 
    * Line 79, 107, 302, 306, 317: Commented out code.
    * Line 82: Not very clear what this loop does.  Consider adding comment.

  * Mirror.java:
    * Lines 29 and 30: Why are these values hard coded?  

  * !SkyBox.java:
    * Lines 75, 81, 87: Magic numbers.  What do these values represent?

*Last minute code review before deliverable 3*

- GameRenderer.java does not an author

- LightPath.java has zero comments, also sans author

-MenuState.java has few comments, no author, and generally looks messy with things commented out.

- Box.java missing some comments on methods

- GameObject.java does not have an author or class comment

- Emitter.java zero comments and no author

- Light.java has zero comments and no author

- Mirror.java has zero comments and no author

- Prism.java has zero comments and no author

- Eraser.java has zero comments and no author

- MirrorTool.java has no comments and no author

- PrismTool.java has no comments and no author

-PrimitivePrism.java has no author

- PrimitiveQuad.java has no comments and no author

- Colliders.java missing some comments and no author

- Plane.java no comments and no author

- Ray.java has no comments and no author

- Sphere.java has no comments and no author
  

== Stephen Damm == 
* ALL IF STATEMENTS NEED BRACERS * 

Under all circumstances, please put braces around all if statements, regardless of how many lines they are. Please run Eclipse -> Project -> Source -> Format on your files before commit.

* !ResourceManager() *

The word resource should not appear in the function names, since it is a ResourceManager.  Something like loadTexture() is more appropriate. The AudioManager is separate but an instance will be maintained by Engine and talked to by resourceManager via the engine.


* !InputSystem() *

The scaleX, scaleY was not being set correctly, Luminance.java should calculate the proper values like ReplicaIsland does and pass it on to Engine deviceChagne.


* GUI() *

Keep class names generic, add a Interface (IWidget).  Here is a helpful link: (http://wiki.allegro.cc/index.php?title=2D_using_OpenGL) it is for OpenGL but most applies to OpenGL ES (except the glVertex() calls, see Box/SkyBox for how to translate it to OpenGL ES).


* Renderer() *

Should be a container for renderable objects, will manage matrix multiplications and then ask objects to render themselves.


* !PrimitiveSphere() *

Should use a sphere generation algorithm (this is a classic 3D problem and task given to students). Here is a long OpenGL version I wrote for my summer work last year in IMG Lab. Convert to OpenGL ES fairly easily. Although it uses QUAD_STRIPS which are a bit slower (TRIANGLE_STRIP is the fastest by far). The hardest part of these algorithms is making sure texture coords wrap properly.

`void drawSphere(double r, int lats, int longs)`

`{`

`int i, j;`

`for(i = 0; i <= lats; i++)`

`{`

`double lat0 = PI * (-0.5 + (double) (i - 1) / lats);`

`double z0 = sin(lat0);`

`double zr0 = cos(lat0);`

`double lat1 = PI * (-0.5 + (double) i / lats);`

`double z1 = sin(lat1);`

`double zr1 = cos(lat1);`

`double tx1 = 0;`

`double ty1 = 0;`

`double tx2 = 0;`

`double ty2 = 0;`

`glBegin(GL_QUAD_STRIP);`

`for(j = 0; j <= longs; j++)`

`{`

`double lng = 2 * PI * (double) (j - 1) / longs;`

`double x = cos(lng);`

`double y = sin(lng);`

`tx1 = atan2(x * zr0, z0) / (2. * PI) + 0.5;`

`ty1 = asin(y * zr0) / PI + .5;`

`if(tx1 < 0.75 && tx2 > 0.75)`

`{`

`tx1 += 1.0;`

`}`

`else if(tx1 > 0.75 && tx2 < 0.75)`

`{`

`tx1 -= 1.0;`

`}`

`tx2 = atan2(x * zr1, z1) / (2. * PI) + 0.5;`

`ty2 = asin(y * zr1) / PI + .5;`

`if(tx2 < 0.75 && tx1 > 0.75)`

`{`

`tx2 += 1.0;`

`}`

`else if(tx2 > 0.75 && tx1 < 0.75)`

`{`

`tx2 -= 1.0;`

`}`

`glTexCoord2f(tx1, ty1);`

`glNormal3f(x * zr0, y * zr0, z0);`

`glVertex3f(x * zr0 * r, y * zr0 * r, z0 * r);`

`glTexCoord2f(tx2, ty2);`

`glNormal3f(x * zr1, y * zr1, z1);`

`glVertex3f(x * zr1 * r, y * zr1 * r, z1 * r);`

`}`

`glEnd();`

`}`

`}`


== Jonny ==
  * Label.java
    * draw() function in the label should be implemented using quads like button.draw() instead of using primitive box.

== Chet Collins ==
  * Sphere.java 
    * No comments
  * Ray.java
    * No comments
  * Plane.java
    * No comments
  * MatrixStack.java
    * Minimal comments, more detail would help
  * Lerp.java
    * No comments
  * Colliders.java
    * Looks good

= Peer Reviews =
== March 14, 2011 ==
=== PrimitiveBox.java ===
 - Stephen explained _vertices and _indices matrices, as well as _textureCoords

Line 105 and 112: Could change 4 to a const called sizeOf(int) or something

Zenja wondered about VBO's and wondering why were aren't using them.  Stephen explained that there is no performance gained using them.

Line 143: why is it _indexBuffer.limit() in draw function.
 - should be tested.  May be lucking out in that the buffer returned is the exact size of the buffer we need.
 - should probably use something else

=== PrimitivePrism.java  ===
Texture does not work currently.  Is rendered as a pyramid, just a matter of making the texture fit it.

Basically the same class as PrimitiveBox, only different vertices etc.


=== PrimitiveQuad.java ===
What is quad?
 - vertices are created at runtime
 - had to do this because we need to create buttons on the fly.

Line 17, 18: why are they static?
 - they could be declared locally in the constructor.  They really don't need to be fields.  If we move it it would probably improve performance slightly.

Line 72: why is there a parameter of _vertices.length/3?
 - without the division, it would still work, but it would keep going and render a bunch of nothing.  This increases performance.

=== PrimitiveSphere.java ===
A billion lines of vertices!!!
 - should use a function to do this!!
  - Although this would be a performance hit.
 - probably don't need so many vertices

Should also use an index array for the vertices.
 - we will only get this if we generate in the algorithm

=== For all the previous classes ===
Since all these primitives are using the same constructor, there could be a superclass for these classes.

We currently don't account for the fact we may have to modify the vertices.  This would be a huge performance hit.  We can get by for now, but should be considered.

Also, when we want to start with special effects such as lighting, we're going to have to implement our objects with more triangles in order for it to look good.

== March 7, 2011 ==
=== Toolbelt.java ===
Line 26: _GRIDPOINT_ERROR - What is this? Needs to be made smaller.  Used as an epsilon for constraining floating point errors.

Line 30: Game state should not be a storage object.  It should be a container for all the other classes; act as a controller.  This causes coupling.  We should try to get this with the toolbelt not talking to game state.

Line 34: List of tools used to loop through to see objects on the grid.  Not necessary.  Be careful with usage.

Line 39 and 40: These are used to indicate a load of a button texture after the parsing of a level file.  Perhaps load all at startup instead of at runtime.

=== Test classes ===
!AndroidSoundPlayerTest.java
 * streamId: why is this 0?  If this is zero, it indicates failure, since player.play returns an int.

!GameRendererRest.java
 * constructor is no longer valid, due to dev team changes.
 * Should be comments on methods

!BoxTest.java
 * Looks good

!GridTest.java
 * Looks good

!LightTest.java
 * Need to fill in with proper tests

!MirrorTest.java
 * Looks good

!EraserTest.java, LightPathTests.java, MirrorToolTest.java, PrismToolTest.java
 * Look good.  Not much there yet as source class isn't complete

!ToolBeltTest.java
 * Needs to say who wrote it.
 * Otherwise looks good

!ButtonTest.java
 * No description of the class.
 
!GUIManagerTest.java
 * No description of the class.
 * testGetNumberOfButtions() currently doesn't work and is commented out.  Don't know why as of yet.
 * testAddButtons() weird comment.  Meant to represent the way the buttons are added in the test, but is unclear.

!LabelTest.java
 * testLabel() doesn't really do anything other than create an object.  No asserts or anything in the function.
 * get rid of testDraw function.  We're not going to be testing OpenGL functions.

!InputButtonTest.java
 * Looks good

!InputKeyboardTest.java
 * Very robust!

!InputSystemTest.java
 * Needs class description
 * testKeyUp(): magic number in for loops (what does 10 represent?)
 * Very robust!

ALL XML TEST CLASSES NEED COMMENTS
!XmlLevelGoalTest.java
 * Needs description and who wrote it
 * why are the parameters passed to the constructor all messed up? i.e. why is the string "rEd" or "WhitE" being passed?
 
!XmlLevelTest.java
 * Looks good

!CollidersTest.java
 * Looks good

!LerpTest.java
 * Looks good

!PlaneTest.java
 * Looks good

!RayTest.java
 * testSetDirection isn't technically testing anything, is just setting values.

!ImageResourceTest.java
 * looks good

!ResourceManagerTest.java
 * shouldn't have the assert in the catch portion of a try-catch.  They will never be called unless there's an exception.

!ResourceTest.java
 * Looks good.

!SoundResourceTest.java
 * Looks good. 

!TextResourceTest.java
 * Looks good.

!TextureResourceTest.java
 * Looks good.

!TimeSystemTest.java
 * copied and pasted throws clause when they may not be necessary.
 * some tests are commented out, need to fix and make them work.

!LuminanceTest.java
 * needs comments and who wrote it.
 * tests aren't written yet since the game has not been in a 'playable' state yet.

= Formal Inspections =
== Milestone 3: Inspection of the resource package ==

*Moderator:* Martina

*Author:* Zenja

*Presenter /Reader:* Zenja

*Inspectors:* Martina, Zenja, Jonny, Kum

*Recorder:* Martina

=== Inspection Meeting:===
 * Defect 1:
  * Location: (ResourceManager.java, 72)
  * Summary: Probably don't need an exception here.
  * Inspectors who discovered it: Zenja and Kum agreed with him
  * Decision: could just be an assert
 * Defect 2:
  * Location: (ResourceManager.java, 90 and 128)
  * Summary: Almost an exact copy of loadResource function.  Simply take different type for parameter.
  * Inspector who discovered it: Zenja
  * Decision: Leave it for now.  It's convenient and both are still useful.
 * Defect 3:
  * Location: (ResourceManager.java, loadTexture())
  * Summary: Should this be in here?  It could be in graphics.
  * Inspectors who discovered it: Zenja, Stephen (not present)
  * Decision: It does belong here.
 * Defect 4:
  * Location (ResourceManager.java, loadSound())
  * Not currently working
  * Inspector who discovered it: Everybody.  We're all aware of this defect.
  * Decision: It's not a priority for this deliverable, but will be fixed in later ones.  Leave for now.
 * Defect 5:
  * Location: (ResourceManager.java, 255)
  * Summary: Dead code.  The way the method is set up, if a file that is attempted to be loaded doesn't exist, and exception is thrown.  Currently, there is a line of code after this that checks stream.available() returns -1, which also may mean the file doesn't exist.  Nobody is sure what this for sure.
  * Martina, Jonny
  * Do some research on it to figure out what exactly its doing.
 * Defect 6: 
  * Location (IResource.java)
  * Summary: Should specify access modifiers
  * Inspectors: Jonny, Kum
  * Should be consistent, so we should put modifiers in this interface as other interfaces use them.
 * Defect 7:
  * Location (Resource.java, 67)
  * Summary: Is this needed anymore (getAssetId())
  * Jonny, Zenja
  * Decision: currently the sound resource doesn't work, and this method is used for debugging.  Will leave for now.
  * Future recommendations
 * Defect 8:
  * Location (ImageResource.java)
  * Needs to be formatted
  * Martina, Zenja
  * Decision: needs to be formatted!!

=== Follow-Up Results ===
Follow-up from Zenja:
  * Defect 1: Changed to be an assert.
  * Defect 2: Left alone; only 2-3 lines are duplicated and there would be some issues with trying to create a common method.
  * Defect 3: Left alone since they could be considered a resource and it's very convenient to allow any part of the project to quickly get a texture.
  * Defect 4: The resource manager part of this is actually probably correct. The reason sound doesn't play is elsewhere.
  * Defect 5: It does seem like it was a useless check; it was removed.
  * Defect 6: Interfaces MUST have public methods. No other access modifier would work. It's acceptable to leave them out, and other interfaces I've seen in the project do so too. We should discuss as a group a confirmation to leave the "public" out everywhere, or put them everywhere possibly.
  * Defect 7: Left alone because it may be needed in the near future for sound playback. Even if not, it may be useful for the game systems to have access to a file descriptor.
  * Defect 8: It was formatted all along. Some javadoc comments look funky but that's because the auto-formatter in use throughout the project makes them that way.

Follow-up from Martina:
  * I checked out the code shortly after these changes.  After a brief visual inspection, I ran the code on the emulator to ensure it still worked as it should.  After probing the program for a bit, I determined the changes did not break anything.
  * I then checked out and some of the tests in the tests suite, and nothing unusual occurred.  
  * I believe it is safe to say that these changes were made successfully.

== Milestone 4: Inspection of the GameState class ==
*Moderator:* Martina

*Author:* Stephen

*Reader:* Stephen

*Inspectors:* Martina, Stephen, Sten, Zenja, Kum, Johnny, Amara

*Recorder:* Sten

=== Inspection Meeting ===
  * Defect 1:
    * Location: GameState.java line 78
    * Summary: Inconsistency with our naming conventions.  Private variable tempPoint should be called `_`tempPoint.
    * Discovered by: Zenja
  * Defect 2:
    * Location: GameState.java lines 169 & 178
    * Summary: beam.clear() is called in these two places and we know that one of them is causing problems with the light staying on the screen after object deletion.
    * Discovered by: Zenja
  * Defect 3:
    * Location: GameState.java lines 181-184
    * Summary: if-statement is in the wrong place in the code and needs to be moved.
    * Discovered by: Stephen
  * Defect 4:
    * Location: GameState.java lines 254-304
    * Summary: Zenja was wondering if using a for-each loop would be faster or more efficient.  We concluded that it shouldn't make a difference.
  * Defect 5:
    * Location: GameState.java lines 295-302
    * Summary: Light is always created going in the same direction.
    * Discovered by: Stephen
  * Defect 6:
    * Location: GameState.java lines 353-369
    * Summary: pause() and resume() should be renamed to systemPause() and systemResume() or something similar.
    * Discovered by: Stephen
  * Defect 7:
    * Location: GameState.java init function
    * Summary: Our try-catch blocks print the stack trace but don't actually handle the errors.  We should make a new exception type that bubbles up to the top of the game and is handled by giving the user a nice error message and quitting the game in a controlled fashion.
    * Discovered by: Martina and Stephen
  * Defect 8:
    * Location: GameState.java lines 472-492
    * Summary: Stephen wondered if these one-line methods were being used at all.  Zenja says that they are.
  * Defect 9:
    * Location: GameState.java line 637
    * Summary: Sky box is scaled improperly.  Looks like it has a low resolution but it doesn't.
    * Discovered by: Zenja
  * Defect 10:
    * Location: GameState.java line 702-706
    * Summary: glHints might be causing the problem with the disappearing light.
    * Discovered by: Zenja
  * Defect 11:
    * Location: GameState.java line 725-736
    * Summary: messageReceived() and isActive() are not needed and should be removed.
    * Discovered by: Stephen

=== Follow-up Results ===

Follow-up from Martina:
  * I checked out the code shortly after these changes.  After a brief visual inspection, I ran the code on the emulator to ensure it still worked as it should.  After probing the program for a bit, I determined the changes did not break anything.
  * I later tried out a version on the phone.  It plays fantastic!
  * I believe it is safe to say that these changes were made successfully.